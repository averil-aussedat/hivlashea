\documentclass{article}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%\usepackage[utf8]{inputenc} % for overleaf/PLM
\usepackage[latin1]{inputenc} % averil local
\usepackage[T1]{fontenc} % hyphenation
\usepackage{fullpage} % DO NOT USE IN BEAMER
\usepackage[british,UKenglish,USenglish,american]{babel}
%\usepackage{appendix}
\usepackage{amssymb,amsmath,amsthm,enumerate}
\usepackage{mathtools} % coloneqq
%\usepackage{easybmat}
\usepackage{enumitem}
%\usepackage{tikz}
%\usepackage{caption}
\usepackage{float} % [H]
%\usepackage{bbold}
\usepackage{xcolor}
\usepackage{stmaryrd} % ll/rr brackets
%\usepackage[notcite, notref]{showkeys}
%\usepackage[tworuled,vlined,nofillcomment]{algorithm2e}
\usepackage[ruled,vlined]{algorithm2e}
%\usepackage{cases} % numbered lines in cases (numcases and subnumcases)
\usepackage[overload]{empheq} % source : https://tex.stackexchange.com/questions/31951/separate-labels-in-cases
\usepackage{caption} % to have subfigures
\usepackage{subcaption} % to have subfigures
\usepackage[allcolors=teal,colorlinks]{hyperref}
\usepackage{orcidlink} % for orcidID, to be loaded after hyperref
\usepackage{cleveref} % \cref. 

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Format
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\title{High order numerical methods for Vlasov-Poisson models of plasma sheaths}
%\title{Numerical simulations of plasma sheaths}
\author{
	Valentin Ayot\footnote{Institut de Math\'ematiques, CNRS, UMR 5251, Universit\'e de Bordeaux, France. \texttt{valentin.ayot@u-bordeaux.fr}}, 
	\ Mehdi Badsi\footnote{Nantes Universit\'e, CNRS, Laboratoire de Math\'ematiques Jean Leray, LMJL, UMR 6629, F-44000 Nantes, France. \texttt{mehdi.badsi@univ-nantes.fr}},
	\ Yann Barsamian\footnote{\'Ecole europ\'eenne de Bruxelles 1, Belgique, \url{yann.barsamian@teacher.eursc.eu}, \orcidlink{0000-0001-6602-0547}}, 
	\ Ana\"is Crestetto\footnote{Nantes Universit\'e, CNRS, Laboratoire de Math\'ematiques Jean Leray, LMJL, UMR 6629, F-44000 Nantes, France. \texttt{anais.crestetto@univ-nantes.fr}},\\
	\ Nicolas Crouseilles\footnote{Inria (Mingus team), IRMAR UMR 6625 and ENS Rennes, Univ Rennes, France. \texttt{nicolas.crouseilles@inria.fr}},
	\ Michel Mehrenberger\footnote{I2M, CMI, UMR 7373, Aix-Marseille Universit\'e, France. \texttt{michel.mehrenberger@univ-amu.fr}},
	\ Averil Prost\footnote{LMI (EA 3226 - FR CNRS 3335), INSA de Rouen, France. \texttt{averil.prost@insa-rouen.fr}}, 
	\ Christian Tayou-Fotso\footnote{Labo. J. A. Dieudonn\'e, UMR 6621, Universit\'e Nice-Sophia Antipolis, France. \texttt{christian.tayou-fotso@unice.fr}}.
 } 
\date{}
\SetKwRepeat{Do}{do}{while} % for algorithm2e package, add do-while

% set dashes instead of bullets for item lists
\setlist[itemize,1]{label=$-$}
\setlist[itemize,2]{label=$-$}
\setlist[itemize,3]{label=$-$}

% remove unnecessary formatting of clever references
\crefdefaultlabelformat{#2#1#3}
\crefname{equation}{}{} \creflabelformat{equation}{(#2#1#3)}
\crefname{section}{Section}{Sections}

% remove paragraph indentation
\setlength{\parindent}{0pt}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Theorems
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newtheorem{proposition}{Proposition}[section]
\newtheorem{definition}{Definition}[section]
\newtheorem{theoreme}{Theorem}[section]
\newtheorem{remarque}{Remark}[section]
\newtheorem{lemme}{Lemma}[section]
\numberwithin{equation}{section}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Commands
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\newcommand{\N}{\mathbb{N}}
\newcommand{\Z}{\mathbb{Z}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\lp}{\left(}
\newcommand{\rp}{\right)}
\newcommand{\tran}[1]{\prescript{t}{}{#1}}
\newcommand{\vol}{\textup{Vol}}
\newcommand{\red}{\textcolor{red}}
\newcommand{\blue}{\textcolor{blue}}

\newcommand{\todo}[1]{{\color{red}\textbf{#1}}}
\newcommand{\vv}[1]{\begin{pmatrix} #1 \end{pmatrix}} % vector
\newcommand{\mysubeq}[2]{ % first argument : label, second : align content
	\begin{subequations}\label{#1}
		\begin{align}[left = {\empheqlbrace}]
			#2
		\end{align}
	\end{subequations}	
}
\newcommand{\mysubcaption}[1]{
	\vspace*{5pt}
	\begin{minipage}{0.8\linewidth}
		\begin{center}
			\footnotesize\emph{#1}
		\end{center}
	\end{minipage}
}
\newcommand{\imh}{\textheight} % meant to be redefined locally
\newcommand{\imw}{\textwidth} % meant to be redefined locally

\newcommand{\highlight}[2]{ % arguments : title, content. Meant for a unified presentation of abstract and aknowledgements
	\begin{center}
		\small
		\begin{minipage}{0.9\textwidth}
			\begin{center}
				\textbf{#1}
			\end{center}
			\vspace*{-7pt}
			#2
		\end{minipage}
	\end{center}
}

%\renewcommand\appendixpagename{Appendix}
%\renewcommand\appendixtocname{Appendix}
\renewcommand{\qedsymbol}{$\blacksquare$}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\begin{document}
	
\maketitle

\highlight{Abstract}{
	This article is a report of the CEMRACS 2022 project, called HIVLASHEA, standing for "{\bf Hi}gh order methods for {\bf Vla}sov-Poisson models for {\bf shea}ths".
	A two-species Vlasov-Poisson model is described together with some numerical simulations, permitting to exhibit the formation of a plasma sheath. 
	The numerical simulations are performed with two different methods: a first order classical finite difference (FD) scheme and a high order semi-Lagrangian (SL) scheme with Strang splitting; for the latter one, the implementation
	of (non-periodic) boundary conditions is discussed. 
	The codes are first evaluated on a one-species case, where an analytical solution is known. For the two-species case, cross comparisons and the influence of the numerical parameters for the SL method are performed in order to have an idea of a reference numerical simulation.
}

\highlight{Aknowledgements}{
	Centre de Calcul Intensif d'Aix-Marseille is acknowledged for granting access to its high performance computing resources. This project has been supported by  the French Federation for Magnetic Fusion Studies (FR-FCM) and by the French ANR project MUFFIN ANR-19-CE46-0004. 
	This work has been carried out within the framework of the EUROfusion Consortium, funded by the European Union via the Euratom Research and Training Programme (Grant Agreement No 101052200 EUROfusion). Views and opinions expressed are however those of the author(s) only and do not necessarily reflect those of the European Union or the European Commission. Neither the European Union nor the European Commission can be held responsible for them.
	
	%This work has been carried out within the framework of the EUROfusion Consortium and has received funding from the Euratom research and training programme \textcolor{red}{2014- 2018 and 2019-2020 under grant agreement No 633053~~~Anais: mettre \`a jour}. The views and opinions expressed herein do not necessarily reflect those of the European Commission. 
	
	
	Finally, authors would like to thanks the CEMRACS organizers, Pierre Navaro for the computational support and the CIRM's boards.
%	\todo{Thanks to Eurofusion, the CEMRACS organizers, the CIRM's boars and of course, to our super advisors (à compléter)}	
}

\section*{Introduction}

Plasmas are neutral at the equilibrium in a sufficiently large domain. However, near a boundary, a charge imbalance may be observed in a thin layer called \emph{sheath}.
This phenomenon stems from the interaction of ions and electrons with the boundary media (a cold metallic wall, for instance). Both species will be absorbed by the wall, but with a rate proportional to their speed. Since the electrons are moving %several order of magnitude 
faster than the ions, a positively charged layer (the \emph{Debye sheath}) forms near the boundary. 

Plasma sheaths are particularly challenging to simulate for several reasons. In this region, 
the plasma parameters (temperature or density) develop steep gradients. Due to their different mass, 
electrons and ions have a very different behaviour close to the boundary, and a two-species model is required 
to describe the formation of the sheath. Moreover, kinetic models are necessary to capture the velocity 
effect of the particles (see \cite{riemannBohmCriterionSheath1991}), and we have to deal with % old cite : \cite{bourneNonUniformSplinesSemiLagrangian2022}
different scales to account for each species.  Hence, we are considering in this work 
a two-species Vlasov model to run simulations of the plasma sheath. 

Recent works are dedicated to the non homogeneous equilibrium sheath, both on the mathematical side and on the numerical side \cite{badsiCollisionalSheathSolutions2021, badsiStableFixedPoint2021, despresMinimizationFormulationBikinetic2016}. 
%We refer to  \cite{bourneNonUniformSplinesSemiLagrangian} for a recent work on the subject.
Regarding the dynamical approaches, one refers to \cite{couletteEulerianVlasovCode2014,bourneNonUniformSplinesSemiLagrangian2022} 
or \cite{badsiNumericalStabilityPlasma2018} for which this study is a follow-up. 
In the latter work, we studied the behaviour of the numerical solution of the Vlasov equation, initialized with a sheath
homogeneous equilibrium. In this work, our purpose is to investigate numerically the formation of a sheath, 
when we include ionization in the model, inspired by the recent work
\cite{alvarezlagunaAsymptoticPreservingWellbalanced2020}
where a fluid model 
is proposed.   

Then, we are concerned by the numerical approximation of the two-species Vlasov model including ionization and boundary. 
To do so, we propose a high order semi-Lagrangian method combined with a time splitting method. 
The presence of boundaries requires specific adaptation to define correctly the semi-Lagrangian method close to the boundary. 
We adapt the strategies developed in \cite{coulombelNeumannNumericalBoundary2020, boutinHighOrderNumerical2021} 
to define inflow and outflow ghost points according to the order of the Lagrange interpolation used in the semi-Lagrangian method.  

The paper is organized as follows: in \cref{sec:model}, we introduce the two-species Vlasov-Poisson system with boundary,  
the numerical methods are described in \cref{sec:nummethods} and \cref{sec:numresults} is devoted to numerical results. 
The different codes are available respectively on \href{https://github.com/JuliaVlasov/DynamicElectricSheath.jl}{https://github.com/JuliaVlasov/DynamicElectricSheath.jl} for the Finite Difference solver, and on \href{https://github.com/averil-prost/HiVlaSheaSL}{https://github.com/averil-prost/HiVlaSheaSL} for the Semi-Lagrangian solver. 

%The difference of speed between both species is numerically challenging, since a wide range of velocities is needed to correctly model the evolution of electrons, but accuracy is required on low velocities to capture the ions. When using mesh-based approaches, it is tempting to use adapted velocity meshes for the different species. This requires the choice of an interpolation procedure: several possibilities are found in the literature, as uniform cubic splines in the GYSELA code \cite{grandgirard5DGyrokineticFull2016} and extension to non-uniform splines in \cite{bourneNonUniformSplinesSemiLagrangian}, or high-order polynomial interpolation \cite{badsiStableFixedPoint2021}. We will follow the latter method.
%
%Our purpose is to investigate numerically the formation of the sheath. It follows previous work of Michel Mehrenberger and Yann Barsamian \todo{is there a reference for the existing code?} on a periodic case, and of \cite{badsiNumericalStabilityPlasma} on a collisional model. Our aim is to study an ionization model with nonperiodic boundary conditions, thus extending the work of \todo{Michel and Yann - how to say it properly?}. The first section introduces the corresponding system, and derives the boundary conditions. The second section presents the numerical methods used to simulate the evolution of the plasma, and the third section gives some results and comparisons.

\section{Plasma sheaths}\label{sec:model}

\paragraph{The model}

Let $t\in\mathbb{R}^+$ denote the time variable, $x\in [-1,1]$ denote the spatial variable in a normalized one-dimensional domain, and $v\in\mathbb{R}$ denote the speed variable. Each species is described through their density in the phase space, denoted by $f_i : (t,x,v) \in \R^+ \times [-1,1]\times \R \mapsto \R$ for the ions, and $f_e : (t,x,v) \in \R^+ \times [-1,1]\times \R \mapsto \R$ for the electrons. Macroscopic quantities will be needed in the modelling, so that we consider the densities $\rho_{i,e}$ and currents $J_{i,e}$ defined by
\begin{align}\label{eq:def_ni_ne}
	\rho_{i,e} (t,x) \coloneqq \int_{v\in\R} f_{i,e} (t,x,v) dv, \quad\text{and}\quad J_{i,e} (t,x) \coloneqq \int_{v\in\R} v f_{i,e} (t,x,v) dv. 
\end{align}
In the sequel, we will denote $\rho (t,x) \coloneqq \rho_i (t,x) - \rho_e(t,x)$, and $J(t,x) \coloneqq J_i(t,x) - J_e(t,x)$.

Phase space densities are assumed to obey the Vlasov equation where the force term is the self-consistent electrostatic potential $\varphi$ which obeys the Poisson equation. In short, the system writes
\mysubeq{eq:unsta_model}{
	\partial_t f_i + v \partial_x f_i - \partial_x \varphi \, \partial_v f_i &= \nu f_e, && (t,x,v) \in \R_{*}^{+} \times (-1,1) \times \R, \label{eq:unsta_model_fi} \\
	\partial_t f_e + v \partial_x f_e + \frac{\partial_x \varphi }{\mu}\, \partial_v f_e &= 0, \quad\quad && (t,x,v) \in \R_{*}^{+} \times (-1,1) \times \R, \label{eq:unsta_model_fe} \\
	- \lambda^2 \partial^2_{xx} \varphi &= \rho, && (t,x) \in \R^{+} \times (-1,1). \label{eq:unsta_model_phi}
}
The physical parameters $\nu$, $\mu$ and $\lambda$ have the following meaning:
\begin{itemize}
\item $\nu \geqslant 0$ is the ionization frequency. It describes the rate of creation %/ production / injection ?} 
of ions in presence of electrons.
\item $\mu \coloneqq m_e / m_i$ is the mass ratio between electrons and ions.
\item $\lambda > 0$ is the Debye length.
\end{itemize}
In the sequel, we may use the electric field $E(t,x) \coloneqq - \partial_x \varphi(t,x)$ instead of the potential. Then, the Poisson equation rewrites as 
\begin{align}
	\lambda^2 \partial_x E (t,x) = \rho(t,x), \quad \quad (t,x) \in \R^{+} \times (-1,1). \label{eq:unsta_model_E}
\end{align}

\begin{remarque}
	To reduce the notations, we will use $f_s$, $s\in\{i,e\}$ to denote either the ionic or the electronic distribution. The Vlasov equations \cref{eq:unsta_model_fi,eq:unsta_model_fe} rewrite 
	\begin{align*}
		\partial_t f_s + v \partial_x f_s - c_s \partial_x \varphi \partial_v f_s = S_s,
	\end{align*}
	with the coefficients $c_s$ and source terms $S_s$ defined as
	\begin{align*}
		c_i \coloneqq 1, \quad c_e \coloneqq -\frac{1}{\mu}, \quad S_i \coloneqq \nu f_e, \quad S_e \coloneqq 0.
	\end{align*}
\end{remarque}

The densities $f_i$ and $f_e$ are subject to initial and boundary conditions, given by
\mysubeq{eq:unsta_model_bc}{
	f_{s}(0,x,v) &\coloneqq f_{s}^0(x,v), && (x,v) \in (-1,1) \times \R, \label{eq:init} \\
	f_{s}(t,x=1,v < 0) = f_{s}(t,x=-1,v > 0) &\coloneqq 0,  && t \in \R^+_*. \label{eq:fie_bc}
}
The homogeneous boundary condition \cref{eq:fie_bc} stems from the non-emitting wall model: the boundary absorbs particles without any reflection. This loss of ionic particles is compensated by the ionization source term in the right hand side of \eqref{eq:unsta_model_fi}. For the electrons, it is expected that the most energetic ones are absorbed by the wall, while the others are confined in the core. 

To completely describe the model, we still need to provide boundary conditions for the Poisson problem \cref{eq:unsta_model_phi}. A first one is given by the choice of a reference potential in the plasma core (at $x=0$)
\begin{align}
	\varphi(t,0) = 0, \quad \quad \forall t \in \R^+. \label{eq:phi_nul_0}
\end{align}
To derive a second boundary condition, we introduce a symmetry assumption.

\paragraph{Symmetries}

We will look for a %regular (say $\mathcal{C}^2$) 
symmetric potential
\begin{align}\label{eq:phi_is_pair}
	\varphi(t,x) = \varphi (t,-x), \quad \quad (t,x) \in \R^+ \times [-1,1].
\end{align}

By derivation with respect to $x \in (-1,1)$, we immediately obtain 
\begin{align*}
	\partial_x \varphi(t,x) = - \partial_x \varphi (t,-x), \quad \text{i.e.} \quad E(t,x) = - E(t,-x).
\end{align*}
 
In fact, assuming \cref{eq:phi_is_pair}, the other quantities of the system also exhibit nice symmetric properties. Let us notice that the Vlasov equations \cref{eq:unsta_model_fi,eq:unsta_model_fe} are driven by the vector fields
\begin{align*}
	(t,x,v) \to (1, v, E(t,x)) \eqqcolon V_i(t,x,v) \quad \text{and} \quad (t,x,v) \to (1, v, -E(t,x)/\mu) \eqqcolon V_e(t,x,v).
\end{align*}
 Both these fields satisfy the radial symmetry $V_s(t,x,v) = V_s(t,-x,-v)$. In consequence, if we assume that $f_s^0(x,v)=f_s^0(-x,-v)$, the solutions $f_s(t,x,v)$ will be radially symmetric around $(t,0,0)$, i.e. 
 \begin{align*}
 	f_i(t,x,v) = f_i(t,-x,-v) \quad \text{and} \quad f_e(t,x,v) = f_e(t,-x,-v), \quad \forall (t,x,v) \in \R^+ \times [-1,1] \times \mathbb{R}.
 \end{align*}

 In particular, we have for the densities and currents 
 \begin{align*}
 	\rho_s (t,x) &= \int_{v\in\mathbb{R}} f_s (t,x,v) dv =  \int_{w\in\mathbb{R}} f_s (t,x,-w) dw = \int_{w\in\mathbb{R}} f_s (t,-x,w) dw = \rho_s (t,-x),  \\ %\quad \text{and} \\
 	J_s (t,x) &= \int_{v\in\mathbb{R}} v f_s (t,x,v) dv =  - \int_{w\in\mathbb{R}} w f_s (t,x,-w) dw = - \int_{w\in\mathbb{R}} w f_s (t,-x,w) dw = - J_s (t,-x).
 \end{align*}
 
 \begin{remarque}[Additional symmetry of $f_e$] Notice that the function $f : (t,x,v) \mapsto f_e(t,x,v) - f_e(t,x,-v)$ satisfies the linear equation 
 	 \begin{align*}
 	 	0 = \partial_t f (t,x,v) + v \partial_x f (t,x,v) - \frac{E(t,x)}{\mu} \partial_v f (t,x,v). % = \vv{\partial_t f & \partial_x f & \partial_v f} \mathrel{\raisebox{\normalbaselineskip}{$\vv{1 \\ v \\ - E/\mu}$}}.
 	 \end{align*}
 	 The boundary condition \cref{eq:fie_bc} gives $f(t,\pm 1, \pm v < 0) = 0$. If, in addition, we assume that the initial condition $f_e^0$ satisfies $f_e^0(x,v) - f_e^0(x,-v) = 0$, then we obtain 
 	 \begin{align}\label{eq:fe_sym_v}
 	 	f_e(t,x,v) = f_e(t,x,-v), \quad \forall (t,x,v) \in \R^+ \times [-1,1] \times \mathbb{R}.
 	 \end{align}
 \end{remarque}
 
 \paragraph{Boundary conditions}
 
 If the potential $\varphi$ is regular, the symmetry assumption gives us $E(t,0) = - E(t,0)$, and we may use the centered Neumann boundary condition
 \begin{align}\label{eq:phi_bc_neumann}
 	\partial_x \varphi (t,0) = 0 \quad \text{or equivalently} \quad E(t,0) = 0
 \end{align}
 to close the Poisson equation \cref{eq:unsta_model_phi}. However, this relies on the assumption that $E$ is continuous at $x=0$, and it is not clear whether any initial condition leads to a stationary state with such a regular electric field. We may avoid this constraint by deriving another Neumann condition (at $x=\pm1$) on the potential which seems to us more physical.
 
% Let us consider the following Neumann boundary condition:
% \begin{align}
% 	\partial_x \varphi(t,\pm 1) \coloneqq C_{\pm} (t) \quad \quad t \in \R^+. \label{eq:phi_bc_C}
% \end{align}
%We wish to derive an expression for the functions $C_{\pm}$. 
First, we derive with respect to time the Poisson equation \cref{eq:unsta_model_phi}
\begin{align*}
	- \partial_t (\lambda^2\partial_{xx}^2 \varphi) = \partial_t \rho, 	
\end{align*}
and considering the difference between the $v$-integration of the Vlasov equations \cref{eq:unsta_model_fi,eq:unsta_model_fe} gives (recalling $\rho=\rho_i-\rho_e$ and $J=J_i-J_e$) 
\begin{align*}
	\partial_t \rho = \nu \rho_e - \partial_x J,
\end{align*}
leads to (using $E=-\partial_x \varphi$) 
\begin{align*}
	\partial_x (\lambda^2\partial_t E + J) = \nu \rho_e, \quad \forall x\in (-1, 1). 	
\end{align*}
Integrating now over $x\in[-1, 1]$ leads to 
\begin{align}\label{eq:ampere_integ}
	\lambda^2\partial_t E(t, 1) + J(t, 1) = \lambda^2\partial_t E(t, -1) + J(t, -1) +\nu \int_{-1}^1 \rho_e (t, x) dx,  
\end{align}
%and time integration gives
%\begin{align*}
%	E(t,1) - E(0,1) = E(t,-1) - E(0,-1) + \frac{1}{\lambda^2} \int_{0}^t \left(J(s,-1) - J(s,1) + \nu \int_{-1}^1 n_e(s,x)\,dx\right) ds.
%\end{align*}

and using the symmetries $E(t,1)=-E(t, -1)$ and  $J(t,1)=-J(t, -1)$, it comes 
\begin{align}\label{eq:ampere_bc}
	\lambda^2\partial_t E(t, \pm 1) + J(t, \pm 1)  = \pm \frac{\nu}{2} \int_{-1}^1 \rho_e (t, x)dx.
\end{align}
Time integration gives a condition of the form $E(t,\pm 1) = C_{\pm}(t)$, where %$\partial_x\varphi(t,\pm 1) = C_{\pm}(t)$, where
\begin{align}\label{eq:ampere_bc_phi}
	E(t,\pm 1) = C_{\pm} (t) \coloneqq E(0,\pm1) - \frac{1}{\lambda^2} \int_0^t J (s, \pm1) ds \pm \frac{\nu}{2 \lambda^2}\int_0^t  \int_{-1}^1 \rho_e (s, x) dx ds. 
\end{align}
This more elaborate 
boundary condition could allow for discontinuities at $x=0$. 
Notice that the values $E(t,\pm 1)$ now depends on the initial value $E(0,\pm1)$, whereas the centered boundary condition \cref{eq:phi_bc_neumann} does not rely on the initial state. 
%\textcolor{red}{NC : ne vaut-il pas mieux definir la constante par rapport au champ $E$ plutot que par rapport au potentiel $\varphi$ dont on ne sert plus ?}

%In the sequel, we chose to consider the centered boundary condition \cref{eq:phi_bc_neumann}.

\section{Numerical methods}\label{sec:nummethods}
In this section, the numerical methods used to approximate the system \cref{eq:unsta_model} are described. 
First, we focus on the Poisson equation and  then, two numerical methods are presented for the Vlasov part. 

\subsection{Poisson equation}\label{ssec:poisson}
 The Poisson problem \cref{eq:unsta_model_phi} is solved with integral representations of the variable $E$.
First, we consider the centered Neumann boundary condition \cref{eq:phi_bc_neumann}. Then, integrating the Poisson equation \cref{eq:unsta_model_E} over $[0,x]$ yields
\begin{align}\label{eq:integral_representation_E_sym}
	E(t,x) = 0 + {\frac{1}{\lambda^2}} \int_0^x \rho(t,y) dy = {\frac{1}{\lambda^2}}\int_0^x \int_{v\in\R} [f_i(t,y,v) - f_e(t,y,v)] dv dy.
\end{align}

\begin{remarque}\label{rk:bc} 
	Instead of imposing $E(t,0)=0$, we can impose $\int_{-1}^1E(t,x)dx=0$ (coming from the symmetry of $\varphi$ \eqref{eq:phi_is_pair}) or even $E(t,1)=-E(t,-1)$. Then we compute (\ref{eq:integral_representation_E_sym}) up to a constant and adjust the constant \textit{a posteriori} to verify the chosen constraint.
\end{remarque}


Let us now consider the boundary condition \cref{eq:ampere_bc_phi}. The spatial domain $[-1,1]$ is split into its positive and negative parts, and integrating \cref{eq:unsta_model_E} gives
\begin{align}\label{eq:integral_representation_E_naturalbc}
	E(t,x) = 
	\begin{cases}
	E(t,\phantom{-}1) - \frac{1}{\lambda^2}\int_{x\phantom{-}}^{1} \rho(t,y) dy =  C_{+}(t) - \frac{1}{\lambda^2}\int_{x\phantom{-}}^1 \int_{v\in\R} [f_i(t,y,v) - f_e(t,y,v)] dv dy, & x \in [0,1], \\
	E(t,-1) + \frac{1}{\lambda^2}\int_{-1}^x \rho(t,y) dy = C_{-}(t) + \frac{1}{\lambda^2}\int_{-1}^x \int_{v\in\R} [f_i(t,y,v) - f_e(t,y,v)] dv dy, & x \in [-1,0).
	\end{cases}
\end{align}

%Note that here, the electric field may "jump" at $x=0$. Both expressions may be approximated by quadrature formulas. 
Moreover, $C_\pm$ is computed at the required time by integrating \eqref{eq:ampere_bc}, between two consecutive time steps.
For the integrals under consideration (in space, velocity and time), we will approximate them by the trapezoidal method. 


\subsection{Finite Differences (FD)}\label{ssec:FDscheme}

Define a numerical computational domain $\Omega \coloneqq [-1,1] \times [-\overline{V},\overline{V}]$, with a large enough maximum speed $\overline{V}$. Let $(x_j, v_k)^{j\in\llbracket0,J\rrbracket}_{k\in\llbracket0,K\rrbracket}$ be a cartesian grid of $\Omega$ of step $(\Delta x, \Delta v)$. We discretize the advection equations on the subgrid $(x_j, v_k)^{j\in\llbracket1,J-1\rrbracket}_{k\in\llbracket1,K-1\rrbracket}$ by an explicit Euler scheme in time, and the upwind scheme in space:
\begin{align}\label{eq:FDscheme}
	\frac{f_{s,j,k}^{n+1} - f_{s,j,k}^{n}}{\Delta t} + D^-_{j,k} f_s^n \vv{v_k\\c_s E_j^n}_{+} +D^+_{j,k} f_s^n \vv{v_k\\c_s E_j^n}_{-} = S_{s,j,k}^n,
\end{align}
where $a_+ = \max(a,0)$ and $a_{-} = \min(a,0)$ are respectively the coordwise positive and negative parts, and the uncentered finite differences are defined as
\begin{align*}
	D^{\pm}_{j,k} f \coloneqq \pm \left(\frac{f_{j\pm 1,k} - f_{j,k}}{\Delta x}, \frac{f_{j,k\pm 1} - f_{j,k}}{\Delta v}\right).
\end{align*}
The values of $f_{s,j,k}^n$ on the boundary ($j=0, J$ and $k=0, K$) are taken as follows:
\begin{itemize}
\item the boundary condition \cref{eq:fie_bc} yields $f_{s,j,k}^n = 0$ whenever $x_j=-1, v_k > 0$ or $x_j=1, v_k < 0$,
\item it is considered that $\overline{V}$ is large enough to take the values on the speed boundary $v_k = \pm \overline{V}$ equal to 0,
\item the remaining values $f_{s,j,k}^n$, $x_j=-1, -\overline{V} < v_k \leqslant 0$ or $x_j=1, 0 \leqslant v_k < \overline{V}$ may be computed using the scheme \cref{eq:FDscheme}, since the sign of the speed allows to use only inner points.
\end{itemize}

%With these approximations, we may compute the electric field $E$ by a quadrature approximation of the integral representation \todo{either} \cref{eq:integral_representation_E_sym} \todo{or} \cref{eq:integral_representation_E_naturalbc}.

\noindent The upwind scheme is known to be diffusive, and stable under the CFL condition 
\begin{align*}
	1 - \max_{k} |v_k| \frac{\Delta t}{\Delta x} - |c_s| \max_{j} |E^n_j| \frac{\Delta t}{\Delta v} \geqslant 0, \quad \forall s \in \{i,e\}\text{ and } n \in \llbracket1,N\rrbracket.
\end{align*}
Given $\Delta x$ and $\Delta v$, we deduce a sufficiently small value of $\Delta t$ with the bound
\begin{align}
	\Delta t \leqslant \min\left(\frac{\Delta x}{\overline{V}}, \min(1,\mu)\frac{\Delta v}{E_{\text{max}}}\right), \quad E_{\text{max}}>0 \text{ postulated \emph{a priori}.}
	\label{eq:CFL}
\end{align}

\subsection{Semi-Lagrangian (SL)}\label{ssec:SLscheme}

The full model \cref{eq:unsta_model} nicely lends itself to approximation by time splitting. Indeed, consider the following Strang splitting decomposition 

%We use a splitting method in time. The full model \cref{eq:unsta_model} is decomposed in elementary operators, namely
%\begin{itemize}
%\item The 1D advection operators along dimensions $x$ and $v$, given by the flows of $\partial_t f + v \partial_x f = 0$ and $\partial_t f + c_s E \partial_v f = 0$, with $c_s \in \{1, -\frac{1}{\mu}\}$.
%\item The resolution of the Poisson problem.
%\end{itemize}
%We use Strang splitting to reach order 2 in time. More precisely, the algorithm is given by

%\todo{EITHER ALGO FORMULATION}
%
%\begin{algorithm}[H]
%	\DontPrintSemicolon
%	\SetAlgoLined
%	Let $f_{i,e}^0$ be given.\;
%	Solve the Poisson problem for $E^0$. \;
%	\For{$n \in \llbracket1,N\rrbracket$}{
%		Solve the homogeneous advection in variable $x$ for $f_{i,e}^*$ on time step $\Delta t/2$.\;
%		Solve the Poisson problem for $E^{n,*}$.\;
%		Solve the pointwise ODE $\partial_t f_i = \nu f_e^{*}$ for $f_i^{**}$ on time step $\Delta t/2$.\;
%		Solve the advection in variable $v$ for $f_{i,e}^{***}$ on time step $\Delta t$.\;
%		Solve the pointwise ODE $\partial_t f_i = \nu f_e^{***}$ for $f_i^{****}$ on time step $\Delta t/2$.\;
%		Solve the Poisson problem for $E^{n+1}$.\;
%		Solve the homogeneous advection in variable $x$ for $f_{i,e}^{n+1}$ on time step $\Delta t/2$.\;
%	}
%	\caption{Semi-Lagrangian scheme}
%\end{algorithm}
%
%\todo{OR EQUATION FORMULATION}

%Following \todo{ref Michel ?}, we decompose the full model \cref{eq:unsta_model} in 	
%\begin{align*}
%	\mathcal{A}_{s,x}^{\Delta t / 2} \circ \mathcal{P}^{\Delta t / 2} \circ \mathcal{A}_{s,v}^{\Delta t} \circ \mathcal{P}^{\Delta t / 2} \circ \mathcal{A}_{s,x}^{\Delta t / 2} 
%\end{align*}
\begin{align*}
	\frac{\Delta t}{2}: \quad\quad&
	\begin{cases}
		\partial_t f_s + v \partial_x f_s = 0 & \text{Linear advection along $x$,} \\
		\lambda^2 \partial_x E = \rho_i - \rho_e & \text{Poisson problem,} \\
	\end{cases} \\
%%%
	\frac{\Delta t}{2}: \quad\quad&
	\partial_t f_i = \nu f_e \quad\quad\quad\quad\quad \text{Ionization,} \\
%%%
	\Delta t: \quad\quad&
	\partial_t f_s + c_s E \partial_v f_s = 0 \quad \text{Linear advection along $v$,} \\
%%%
	\frac{\Delta t}{2}: \quad\quad&
	\partial_t f_i = \nu f_e \quad\quad\quad\quad\quad \text{Ionization,} \\
%%%
	\frac{\Delta t}{2}: \quad\quad&
	\begin{cases}
		\lambda^2 \partial_x E = \rho_i - \rho_e & \text{Poisson problem,}\\
		\partial_t f_s + v \partial_x f_s = 0 & \text{Linear advection along $x$.}
	\end{cases} 
\end{align*}

%\todo{END EITHER OR.}


Each of the splitting steps may be solved exactly in time.
%\textcolor{red}{(NC: pas vraiment "exactly" \`a cause des conditions aux bords $C_\pm$ qui font intervenir des int\'egrales en temps ; on avait construit une m\'ethode de type trap\`eze en temps pour cela qu'on pourrait \'ecrire)}. 
Indeed, the Poisson problems are solved by the integral representation \cref{eq:integral_representation_E_sym}. The ionization steps are pointwise ODE with time-independant source term, and are exactly solved by the explicit Euler scheme. Finally, notice that each advection is at constant speed with respect to the advection variable. This allows for the use of elementary 1D solvers.  

The use of the decentered boundary condition requires a discretization of \cref{eq:integral_representation_E_naturalbc}, and may penalize the time order of the splitting method. In the sequel, we will consider only the symmetric boundary condition \cref{eq:phi_bc_neumann}.

%\todo{We now describe the treatment of the boundaries.} 
%In order to describe the algorithm completely, we need to give the detail of the resolution of the Poisson problem. 


\paragraph{Numerical treatment of the boundaries}

%The full model \cref{eq:unsta_model} includes multi-dimensional advection equations for $f_{i,e}$, supplemented with well-placed boundary conditions \cref{eq:fie_bc}. However, the main algorithm uses a splitting method that relies on 1D advection solvers. Therefore, we may first
Let us focus on the elementary advection equation with constant speed $a>0$
\begin{align*}
	\partial_t f (t,x) + a \partial_x f(t,x) = 0, \quad f(t,-1) = 0, \quad \forall (t,x) \in \R^+_* \times (-1,1).
\end{align*}
Let $(x_j)_{j\in\llbracket0,J\rrbracket}$ be a space mesh of step $\Delta x \coloneqq 2/J$, and $(t_n)_{n\in\llbracket 0,N \rrbracket}$ be a time mesh of step $\Delta t \coloneqq T/N$.
We follow the work of \cite{coulombelNeumannNumericalBoundary2020, boutinHighOrderNumerical2021}, and consider a semi-Lagrangian scheme defined as
\begin{align*}
	f^{n+1}_j = \text{Lagrange interpolation}\left(f^n, x_j - a \Delta t\right) \coloneqq \sum_{k=-d}^{d+1} f^n_{j_0+k} L_k (\alpha), \ 
\end{align*}
with $(L_k)_{k\in\llbracket-d,d+1\rrbracket}$ the Lagrange polynomials of degree $(2d+1)$ defined by $L_k(z)=\prod_{\ell=-d,\ell\not=k}^{d+1}\frac{z-k}{\ell-k}$
(which satisfy $L_k(\ell) = \delta_{k\ell}$ for $\ell\in \llbracket-d,d+1\rrbracket$), and $x_j - a \Delta t = x_{j_0}+\alpha \Delta x,\ j_0\in \mathbb{Z}, \alpha\in [0,1[$.
%satisfying $L_k(x_l) = \delta_{kl}$. The stencil of the Lagrange interpolation uses $2d + 2$ points, where $d\in\N$.
%The Lagrange interpolation will use a centered stencil of $2d+2$ points, where $d\in\N$. 
The boundaries are treated as follows:
\begin{itemize}
\item the \emph{inflow} side, corresponding to $x=-1$, relies on the analytical solution $f(t,x) = 0$ $\forall x \leqslant a t$. Whenever the scheme needs a value $f^n_j$ with $j < 0$, it may be exactly taken equal to 0.
\item in the case $d>0$, the Lagrange stencil may also need \emph{outflow} values $f^n_{j}$ with $j>J$. Such values may be determined by polynomial extrapolation. Let $k_b \in \N$, and let $p$ be the unique polynomial of degree $k_b$ interpolating $(x_j, f^n_j)$ for $j\in \llbracket J-k_b,J\rrbracket$. The \emph{outflow ghost points} will be defined by $f^n_j \coloneqq p(-1 + j \Delta x)$, $\forall j > J$. The couple $(d,k_b)$ characterizes the chosen scheme. 
%{\textcolor{red}{(NC: j'aurais mis $f^n_j \coloneqq p(1+j\Delta x)$  $\forall j>0$ ou alors $f^n_j \coloneqq p(-1+j\Delta x)$  $\forall j>J$)}} 
%{\textcolor{red}{(NC: N'y a-t-il pas une relation entre $k_b$ et $d$ ?)}}
%\textcolor{red}{Anais: ne devrait-on pas insister sur le fait que c'est une des nouveautes de ce travail? Je trouve que ce n'est pas assez mis en valeur. Par contre, il y avait la ref Boutin et al qu'il faudrait citer?}
\end{itemize}

%\subsection{Fixed-point (FP)}
%
%This algorithm is heavily inspired from the fixed-point procedure developped in \cite{badsiStableFixedPoint2021} for a collisional model.
%We focus on the equilibrium state $(f_i, f_e, \varphi)$ solving the stationary system
%%\begin{align}\label{eq:sta_model}
%%	\begin{cases}
%%		v \partial_x f_i (x,v) - \partial_x \varphi(x) \partial_v f_i(x,v) = \nu f_e (x,v) & (x,v) \in ]-1,1[ \times \R, \\
%%		v \partial_x f_e (x,v) + \frac{1}{\mu}\partial_x \varphi(x) \partial_v f_e(x,v) = 0 & (x,v) \in ]-1,1[ \times \R,\\
%%		- \lambda^2 \partial^2_{xx} \varphi (x) = n (x) & x \in ]-1,1[.
%%	\end{cases}
%%\end{align}
%\begin{subnumcases}{\label{eq:sta_model}}
%		v \partial_x f_i (x,v) - \partial_x \varphi(x) \,\partial_v f_i(x,v) = \nu f_e (x,v) \quad\quad (x,v) \in ]-1,1[ \times \R, \label{eq:sta_model_fi} \\
%		v \partial_x f_e (x,v) + \frac{\partial_x \varphi(x)}{\mu} \partial_v f_e(x,v) = 0 \hfill (x,v) \in ]-1,1[ \times \R, \label{eq:sta_model_fe}\\
%		- \lambda^2 \partial^2_{xx} \varphi (x) = n (x) \hfill x \in ]-1,1[. \label{eq:sta_model_phi}
%\end{subnumcases}
%
%To be consistent with the evolutionary model \cref{eq:unsta_model}, the following boundary conditions are considered:
%\begin{subnumcases}{}
%		\varphi(0) \coloneqq 0  & Reference potential, \\
%		\pm \partial_x \varphi(\pm 1) \coloneqq C & Neumann boundary conditions, \\
%		f_{s}(x=\pm 1,\pm v < 0) \coloneqq 0 & Non-emitting boundary conditions.
%\end{subnumcases}
%However, the problem lack some additional information to be well-posed. Indeed, the advection equation \cref{eq:sta_model_fe} implies that $f_e$ is constant along its characteristic lines, given by the level lines of the infinitesimal energy $\mathcal{L}_e (x,v) \coloneqq \frac{v^2}{2} - \frac{\varphi}{\mu}$. According to the structure of $\varphi$, these curves are closed, and may not cross the boundary $x=\pm 1$ (see \cref{fig:characteristics}). We give a value to these lines by enforcing
%\begin{align}\label{eq:sta_feb}
%	f_e(0,v) = f_{e,b} (v), \quad \forall v \leqslant 0. 
%\end{align}
%\todo{Accorder les notations entre Mehdi, Nicolas, AnaÃ¯s, Michel, Yann, le pape et Averil.}
%
%\begin{figure}
%	\centering
%	\includegraphics[width=0.9\linewidth]{images/characteristics}
%	\caption{Typical structure of the characteristic lines in the plan $(x,v)$.}
%	\label{fig:characteristics}
%\end{figure}
%
%Let us describe the fixed-point steps. Suppose that a candidate $\varphi^k$ is given. Then:
%\begin{enumerate}
%\item We may deduce the characteristic lines for the equations \cref{eq:sta_model_fi,eq:sta_model_fe}, and compute approximations $f_{i,e}^k$.
%\item By integration on $v$, we may compute $n^k \coloneqq n_i^k - n_e^k$.
%\item The next iterate $\varphi^{k+1}$ is defined as the solution of the Poisson problem \cref{eq:sta_model_phi} with source term $n^k$.
%\end{enumerate}

\section{Numerical results}\label{sec:numresults}

The semi-Lagrangian code is written in \texttt{C}; it uses subroutines (translated from \texttt{Fortran}) of the \texttt{selalib} library\footnote{\url{https://selalib.github.io/selalib.html}}. The code works in parallel using \texttt{MPI}.
The finite difference scheme has been written in \texttt{Julia}.

\subsection{One species validation test case}

We rely on the work of \cite{malkovNonstationaryAntonovSelfgravitating2020} to provide an analytical solution in a one-species case. Consider the simplified 
%{\textcolor{red}{(NC: pourquoi 'stationary' ?)}} 
model describing the density of particles $f = f(t,x,v)$, and the potential $\varphi=\varphi(t,x)$:
\mysubeq{eq:one_species_model}{
	\partial_t f + v \partial_x f  - \partial_x \varphi \partial_v f &= 0, && (t,x,v) \in \R^+_* \times (-1,1) \times \mathbb{R}, \label{sta_1sp_f} \\
	\partial^2_{xx} \varphi &= \int_{v\in\mathbb{R}} f dv, && (t,x) \in \R^+ \times (-1,1). \label{sta_phi}
}
The initial and boundary conditions are given by 
\mysubeq{eq:one_species_model_bc}{
	f(0,x,v) \coloneqq f^0(x,v), \quad f(t,x=\pm1, \pm v < 0) &= 0,  \\
	\varphi(t,0) = \partial_x \varphi (t,0) &= 0.  
}
This model may be seen as a particular case of the two-species Vlasov-Poisson \cref{eq:unsta_model}, upon taking the following parameters:
\begin{align*}
	f_i^0 \equiv 0, \quad \nu = 0, \quad \mu = -1, \quad \lambda = 1, \quad f_e^0 = f^0.
\end{align*}
One may verify that \cref{eq:one_species_model} is solved in $\R^+ \times [-1,1] \times \mathbb{R}$ by the following stationary couple:
\begin{align}\label{eq:Malkov_solution}
	f(t,x,v) \coloneqq 
	\begin{cases}
		\frac{1}{\pi} \left(1 - x^2 - v^2\right)^{-1/2} & \text{if } x^2 + v^2 < 1,  \\
		0 & \text{otherwise}, 
	\end{cases} \quad \text{and} \quad
	\varphi(t,x) \coloneqq \frac{x^2}{2}.
\end{align}
It is numerically relevant to extend the Malkov solution \cref{eq:Malkov_solution} to spatial domains $x \in [-1-\varepsilon, 1+\varepsilon]$ by 
\begin{align}\label{eq:Malkov_solution_ext}
	f(t,x,v) \coloneqq 
	\begin{cases}
		\frac{1}{\pi} \left(1 - x^2 - v^2\right)^{-1/2} & \text{if } x^2 + v^2 < 1, \\
		0 & \text{otherwise}
	\end{cases}, \quad \text{and} \quad
	\varphi(t,x) \coloneqq \left\{\begin{array}{c}
	x^2/2,\ \ \left|x\right|<1,\\
	|x|-\frac{1}{2},\ \left|x\right|\ge 1.
	\end{array}\right.%\min\left(\frac{x^2}{2}, \frac{|x|}{2}\right).
\end{align}

\Cref{fig:malkov_solutions} illustrates the stationary solutions.

\begin{figure}
	\centering
	\renewcommand{\imh}{0.33\linewidth}
	\includegraphics[trim = 50 10 55 30, clip, height=\imh]{images/malkov_solution_Ee}
	\includegraphics[trim = 100 10 60 30, clip, height=\imh]{images/malkov_solution_fe}
	\caption{Malkov solutions \cref{eq:Malkov_solution_ext} on $[-1.5,1.5]\times[-2,2]$. Left: electric field $E$. Right: density $f$.}
	\mysubcaption{The electric field is extended outside of $[-1,1]$ by a constant. The density $f$ is represented in the domain $[-1.5,1.5]\times[-2,2]$, and truncated to 10.}
	\label{fig:malkov_solutions}
\end{figure}

\paragraph{Validation of the FD scheme}

This stationary test first let us validate the Finite Difference scheme presented in Subsection \ref{ssec:FDscheme} associated to the boundary condition (\ref{eq:phi_bc_neumann}) for the electric field (computed by (\ref{eq:integral_representation_E_sym})). Considering (x,v)-domain $[-1,1]\times[-2,2]$, we compute the $L^2$-errors on electric field at time 0.1. Figure \ref{fig:DFerrors} presents the error as a function of $\Delta x$ for different fixed values of $N_v=K+1$ (on the left) and as a function of $\Delta v$ for different fixed values of $N_x=J+1$ (on the right). Time step $\Delta t$ is computed thanks to the CFL condition (\ref{eq:CFL}), $K$ (resp. $J$) being chosen such that $\Delta t$ is fixed along each curve. In both plots (presented in log-log scale), we recover convergence of rate 1, as expected, until a saturation is reached.

\begin{figure}
	\centering
	\renewcommand{\imh}{0.33\linewidth}
	\includegraphics[width=0.48\textwidth]{images/error_E_en_dx_acstcase.png}
	\includegraphics[width=0.48\textwidth]{images/error_E_en_dv_acstcase.png}
	\caption{FD code for one species case. $L^2$-errors on electric field at time 0.1, as a function of $\Delta x$ (left) or $\Delta v$ (right).}
	\label{fig:DFerrors}
\end{figure}


In Figure \ref{fig:DF_fe_and_bc} 
%left, we plot electronic distribution function at time 0.1, obtained with a refined mesh $N_x=2048$, $N_v=2049$. This highlights the diffusion of the solution. The plot on the right 
we aim at comparing the three approaches for the computation of electric field presented in Subsection \ref{ssec:poisson}. Imposing $E(t,x=0)=0$ as proposed in (\ref{eq:phi_bc_neumann}) or $\int E(t,x)dx=0$ as discussed in Remark \ref{rk:bc} leads to two similar solutions, that are exact at $x=0$ due to the properties of this  case. Now, computing $E$ from (\ref{eq:ampere_bc_phi})-(\ref{eq:integral_representation_E_naturalbc}) leads to an exact solution on boundaries $x=-1$, $x=1$ but a jump in $x=0$. Even if the exact solution is continuous in $x=0$, it is not always the case in physically relevant applications. %The third approach is less restrictive but first and second approaches are interesting in the present case.

\begin{figure}
	\centering
	\renewcommand{\imh}{0.33\linewidth}
	%\includegraphics[width=0.48\textwidth]{images/fe_acstcase_T01_Nx2048_Nv2049_domain1.png}
	\includegraphics[width=0.48\textwidth]{images/diff_E_3bc_acstcase.png}
	\caption{FD code for one species case. Parameters $N_x=2048$, $N_v=2049$, time 0.1. Computed minus exact $E$ as a function of $x$ with three approaches (imposing $E(t,x=0)=0$, imposing $\int E(t,x)dx=0$, computing $E(t,x)$ from $J$ with (\ref{eq:integral_representation_E_naturalbc})).}
	\label{fig:DF_fe_and_bc}
\end{figure}

%The last validation will help us compare the Finite Difference scheme with the semi-Lagrangian one. It consists in plotting the $L^1$ error on the electric field as a function if $x$ for different sets of numerical parameters. 


%\todo{For now, I don't reach order 1. Maybe bug?}

%\begin{figure}[H]
%	\input{ltf_Malkov_DF}
%%	\input{ltf_Malkov_SL}
%\end{figure}


\paragraph{Validation of the SL scheme}


Results for the semi-Lagrangian code are given on Figure \ref{fig:SLresult1sp}. Instead of evaluating the numerical solution on a point $(x,v)$, we use a quadrature to approximate its average on the cell of size $(\Delta x, \Delta v)$ centered in $(x,v)$. 
%On each cell, instead of doing a single point evaluation, we use a quadrature to compute an average value on a centered rectangle around the point value
%(of size $\Delta x \times \Delta v$) \textcolor{red}{AC and NC : on ne comprend pas trop cette phrase}. 
We evaluate the error on the electric field for different values of $N_x=N_v=N$. We see on the left figure that the scheme converges when $N$ increases at initial time.
% and saturates to time discretization error for $T=1$. 
Then, on the right figure, we plot the error on the electric field at $T=1$. Dividing the time step by two (resp. by four), we observe that the error is divided by around $4$ (resp. $16$), which illustrates the second order in time of the Strang splitting. The test is quite difficult (the function goes to infinity on one side and then is equal to zero on the other side) 
and large values of $N$ have to be used to clearly see the convergence.
 


\begin{figure}
	\centering
	\renewcommand{\imh}{0.45\linewidth}
	\begin{tabular}{cc}
	\includegraphics[width=\imh]{images/malkov_SL1.png} & %\includegraphics[width=\imh]{images/malkov_SL2.png} \\
	%\includegraphics[width=\imh]{images/malkov_SL3.png} & 
	\includegraphics[width=\imh]{images/malkov_SL4.png}
	\end{tabular}
	\caption{SL code for one species case. Left: Electric field error for $x\in [-1,1]$, at initial time. 
	%at time $T=1$, for $\Delta t=0.1$ (top right); at time $T=1$, for $\Delta t=0.05$ (bottom left); 
	Right: at time $T=1$, error of electric field for $\Delta t=0.1$,
	$4$ times error of electric field for $\Delta t=0.05$, $16$ times error of electric field for $\Delta t=0.05$. We use $N\in \{16,32,64,128,256,512,1024\}$ cells in each direction. For each cell we compute the average value of $f$
	at initial time using $N$ points in each direction.}
	\label{fig:SLresult1sp}
\end{figure}

\subsection{Two species case} % and comparison between (SL) and (FD)}
In this part, we focus on the two-species model \eqref{eq:unsta_model} 
and use the following physical parameters:
\begin{align}\label{eq:param_simu}
	\lambda = \frac{1}{2}, \quad \mu = \frac{1}{100}, \quad\text{and}\quad \nu = 20.
\end{align}
The initial conditions are chosen as the thermodynamic equilibrium in an infinite spatial domain, or in a domain with periodic condition. The densities are then given by
\begin{align*}
	f_{i}^0 (x,v) \coloneqq \frac{\exp\left(- \frac{v^2}{2}\right)}{\sqrt{2\pi}} \quad \text{and} \quad f_{e}^0 (x,v) \coloneqq \sqrt{\mu}\frac{\exp\left(- \mu \frac{v^2}{2}\right)}{\sqrt{2\pi}}.
\end{align*}
In order to satisfy the boundary conditions, we multiply $f_{i,e}$ by a mask, defined as
\begin{align*}
	\text{mask}(x,v) \coloneqq \frac{1}{2} \left(\tanh\left(\frac{x - (-0.8)}{0.1}\right) - \tanh\left(\frac{x - 0.8}{0.1}\right)\right).
\end{align*}
If the boundary condition is not satisfied, the sharp profile at the boundary may induce spurious oscillations in the Lagrange interpolation during the first steps of the simulation.
\Cref{fig:init_cond} illustrates the resulting initial conditions.
\begin{figure}
	\centering
	\renewcommand{\imh}{0.33\linewidth}
	\includegraphics[height=\imh]{images/fi_init}
	\includegraphics[height=\imh]{images/fe_init}
	\caption{Initial conditions $f_i^0$ (left) and $f_e^0$ (right).}
	\label{fig:init_cond}
\end{figure}

The simulations run over the spatial domain $x \in [-1,1]$. The semi-Lagrangian (SL) code computes the electron velocities on $v_e \in [-60, 60]$, and ion velocities on $v_i \in [-50, 50]$. The finite differences (FD) code uses the same mesh for ions and electrons, chosen as $v\in[-60,60]$. To simplify the comparison, visualisations of $f_i$ are restricted to the coordinates $f_{i,j,k}$ such that $v_k \in [-5,5]$.
For the finite differences code, we use $N_x=512$, $N_{v_e}=N_{v_i}=513$; the time step is computed in order to satisfy the CFL condition; a further time step is used for terminating to the final time $T$.  
For the semi-Lagrangian code, we will use

\input{ltf_runs.tex}

%\begin{itemize}
%\item Run0: $N_x=512$, $N_{v_e}=N_{v_i}=513$, $\Delta t = 0.00025$,
%\item Run1: $N_x=256$, $N_{v_e}=8193$ and $N_{v_i}=2049$, $\Delta t = 0.00025$,
%\item Run2: $N_x=1024$, $N_{v_e}=8193$ and $N_{v_i}=2049$, $\Delta t = 0.00025$,
%\item Run3: $N_x=1024$, $N_{v_e}=8193$ and $N_{v_i}=2049$, $\Delta t = 0.000025$.
%\end{itemize}

For the SL scheme, we always use $d=8$ with periodic boundary conditions for the interpolation in velocity, and $k_b=1$ together with $d=2$ for the spatial interpolation.
Lagrange interpolation of degree $3$  (that is, $d=1$) is used for passing from the ion velocity mesh to the electron velocity mesh (which is needed for the ionization step).

As diagnostics, we represent the electric field $E$, the charge density $\rho=\rho_i-\rho_e$, the ion distribution function $f_i$ and the electron distribution function $f_e$ at different times $T\in \left\{0.1,0.2,1,2,5,20\right\}$.

\paragraph{Short time}

We first look at the results for short times: $T=0.1$ (Figure \ref{fig:compT01}) and $T=0.2$ (Figure \ref{fig:compT02}). For the semi-Lagrangian code, we use the parameters of Run2, which gives a reference solution.
We see that the results are very similar with the FD code for $T=0.1$, which permits to validate the results by cross comparisons. For $T=0.2$, differences begin to appear; the sharp profile of $f_e$ is not well
reproduced by the FD scheme which has also a coarser mesh. We can see also the differences on the charge density.

%The same simulation at time $T=0.1$ shows a greater divergence between both methods. The electric field does not have the same extremal values, and the comparison of $\rho$ reveals a difference of variations. The approximations of the ion density $f_i$ seem quite similar, but the shape of the electric density $f_e$ differs: the semi-lagrangian code produces sharper approximation and a more elongated profile.


\begin{figure}
	\centering
	\newcommand{\rootSL}{../code_SL/}
%	\newcommand{\rootFD}{../../DynamicElectricSheath.jl/data/two_species/}
	\newcommand{\rootFD}{../temp_res_DF/}
	\newcommand{\dirSL}{run_comp_short_time_2sp_Nx1000_Nvi2001_Nve2001_Nt6250}
	\newcommand{\dirFD}{run_comp_short_time_2sp_Nx1000_Nv2000_Nt6250}
	
	\renewcommand{\imh}{0.24\textheight}
	\renewcommand{\imw}{0.45\linewidth}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/ET0p1_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/ET0p1.png}
		\caption{Electric field }
		\label{subfig:compT01_E}
	\end{subfigure}

	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/rhoT0p1_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/rhoT0p1.png}
		\caption{Density $\rho$}
		\label{subfig:compT01_rho}
	\end{subfigure}
	
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/fiT0p1_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/fiT0p1.png}
		\caption{Ion distribution function}
		\label{subfig:compT01_ion}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/feT0p1_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/feT0p1.png}
		\caption{Electron distribution function}
		\label{subfig:compT01_electron}
	\end{subfigure}
	\caption{Comparison between finite differences (left) and semi-Lagrangian (right) schemes at $T=0.1$. The semi-Lagrangian code uses parameters of Run2.}
	\label{fig:compT01}
\end{figure}  

\begin{figure}
	\centering
	\newcommand{\rootSL}{../code_SL/}
%	\newcommand{\rootFD}{../../DynamicElectricSheath.jl/data/two_species/}
	\newcommand{\rootFD}{../temp_res_DF/}
	\newcommand{\dirSL}{run_comp_short_time_2sp_Nx1000_Nvi2001_Nve2001_Nt6250}
	\newcommand{\dirFD}{run_comp_short_time_2sp_Nx1000_Nv2000_Nt6250}
	
	\renewcommand{\imh}{0.24\textheight}
	\renewcommand{\imw}{0.45\linewidth}
	
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/ET0p2_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/ET0p2.png}
		\caption{Electric field }
		\label{subfig:compT02_E}
	\end{subfigure}

	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/rhoT0p2_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/rhoT0p2.png}
		\caption{Density $\rho$}
		\label{subfig:compT02_rho}
	\end{subfigure}
	
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/fiT0p2_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/fiT0p2.png}
		\caption{Ion distribution function}
		\label{subfig:compT02_ion}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/feT0p2_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/feT0p2.png}
		\caption{Electron distribution function}
		\label{subfig:compT02_electron}
	\end{subfigure}
	\caption{Comparison between finite differences (left) and semi-Lagrangian (right) schemes at $T=0.2$. The semi-Lagrangian code uses parameters of Run2.}
	\label{fig:compT02}
\end{figure}  


\paragraph{Long time}

Now, we turn to the long-term simulations, with $T=20$, on Figure \ref{fig:compT20}.  %Here, we free the semi-Lagrangian code from the artificial CFL condition imposed for fair comparisons. \Cref{fig:compT200} illustrates the behavior of both codes on long time, with parameters given by \cref{eq:param_simu}. 
%
The finite difference code suffers from numerical diffusion, and the approximations of $f_i$ and $f_e$ are very damped. Electric field and charge density are really different.
On the contrary, the SL scheme gives much better results (in comparison with refined runs, as we will see later), while it uses the same number of points. We can distinguish a little degradation of the symmetry, by looking at the charge density.
%almost everywhere reduced to 0. %The point $(x=0,v=0)$ stands out, since it is an equilibrium point: the value $f_e(t,0,0)$ is constant with respect to $t$ (both in the continuous model, and in the discrete model provided $(x=0,v=0)$ belongs to the mesh), and 
%\begin{align*}
%	\partial_t f_i (t,0,0) = f_e(t,0,0),  \quad \text{so that} \quad f_i(t,0,0) = f_i(0,0,0) + t f_e(0,0,0).
%\end{align*}
%This explains the results of \cref{fig:compT200}. The value $f^n_{e,j_0,k_0} \simeq f_e(T,0,0)$ is stationary, but the maximum of $f_e^n$ outside a small neighbourhood of $(x=0,v=0)$ is 0 at machine precision.
%%The numerical maximum of $f_i$ is equal to $159.97581842617524$, and the error with respect to $f_i(0,0,0) + (T=200) \times (\nu = 20) \times f_e(0,0,0)$ is of order $10^{-8}$. 
%The value $f^n_{i,j_0,k_0} \simeq f_i(T,0,0)$ is not taken into account in the colormap, since
%\begin{align*}
%	\max_{j,k} f^n_{i,j,k} = f^n_{i,j_0,k_0} = 159.97581842617524, \quad \text{and} \quad \left|f^n_{i,j_0,k_0} - (f^0_{i,j_0,k_0} + T \nu f^0_{e,j_0,k_0})\right| = 8.98 \times 10^{-9}.
%\end{align*}
%
%At the opposite, the semi-Lagrangian scheme does not produce vanishing approximations. 


\begin{figure}
	\centering
	\newcommand{\rootSL}{../code_SL/}
%	\newcommand{\rootFD}{../../DynamicElectricSheath.jl/data/two_species/}
	\newcommand{\rootFD}{../temp_res_DF/}
	\newcommand{\dirSL}{run_comp_short_time_2sp_Nx1000_Nvi2001_Nve2001_Nt6250}
	\newcommand{\dirFD}{run_comp_short_time_2sp_Nx1000_Nv2000_Nt6250}
	
	\renewcommand{\imh}{0.24\textheight}
	\renewcommand{\imw}{0.3\linewidth}
	
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/ET20_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/ET20_512.png}
		\includegraphics[height=\imh,width=\imw]{images/ET20_512_3.png}
		\caption{Electric field }
		\label{subfig:compT02_E}
	\end{subfigure}

	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/rhoT20_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/rhoT20_512.png}
		\includegraphics[height=\imh,width=\imw]{images/rhoT20_512_3.png}
		\caption{Density $\rho$}
		\label{subfig:compT02_rho}
	\end{subfigure}
	
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/fiT20_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/fiT20_512.png}
		\includegraphics[height=\imh,width=\imw]{images/fiT20_512_3.png}
		\caption{Ion distribution function}
		\label{subfig:compT02_ion}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/feT20_FD.png}
		\includegraphics[height=\imh,width=\imw]{images/feT20_512.png}
		\includegraphics[height=\imh,width=\imw]{images/feT20_512_3.png}
		\caption{Electron distribution function}
		\label{subfig:compT02_electron}
	\end{subfigure}
	\caption{Comparison between finite differences (left) and semi-Lagrangian (middle and right) schemes at $T=20$. The semi-Lagrangian code uses parameters of Run0 (middle $E(t,0)=0$, right $\int_{-1}^1E(t,x)dx=0$.)
	%, with $N_x=512,\ N_{v_e}=N_{v_i}=513$ for both codes. %For the semi-Lagrangian code, we use $\Delta t=0.00025$, $[-60,60]$ for $v_e$ and  $[-50,50]$ for $v_i$. The ion density is zoomed for $v_i\in [-5,5]$
	}
	\label{fig:compT20}
\end{figure}  


\paragraph{Looking for a reference solution} %Numerical results for the SL code for different discretizations}

It is not easy to find a reference solution, as we look for long time solution, and the ionization parameter needs to be adjusted to ensure the stationarity of the solution. The space scale must be able to capture thin structures, as the Vlasov equation is prone to filamentation. We have here also the problem that electrons and ions have different time scales, which implies that short time steps have to be used in order to be able to follow the dynamics (even if we use here a semi-Lagrangian scheme, whose time step is not restricted by the strong CFL condition
of the finite difference scheme).

It is interesting to notice that we can have converged solutions in space for a fixed time step, taking for example $\Delta t = 0.0025$ (or even $\Delta t =0.025$), but the corresponding solution is then not (at all) converged in time
(results are shown on Figure \ref{fig:comp_temps2}; we can remark that the results on charge density can be quite different; looking at the electron distribution function, we see some shifting
of the solution, and even more changes for $\Delta t =0.025$). 

\begin{figure}
	\centering
	\newcommand{\rootSL}{../code_SL/}
%	\newcommand{\rootFD}{../../DynamicElectricSheath.jl/data/two_species/}
	\newcommand{\rootFD}{../temp_res_DF/}
	\newcommand{\dirSL}{run_comp_long_time_2sp_Nx1000_Nvi2001_Nve2001_Nt100000}
	\newcommand{\dirFD}{run_comp_long_time_2sp_Nx200_Nv400_Nt2500000}
	
	\renewcommand{\imh}{0.24\textheight}
	\renewcommand{\imw}{0.45\linewidth}
	
%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh,width=0.3\linewidth]{images/rhoT10_run5u.png}
%		\includegraphics[height=\imh,width=0.3\linewidth]{images/rhoT10_run5v.png}
%		\includegraphics[height=\imh,width=0.3\linewidth]{images/rhoT10_run5w.png}
%		\caption{$T=1$}
%		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
%		%\label{subfig:compT200_E_rho}
%	\end{subfigure}

	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=0.45\linewidth]{images/rhoT5_run5af.png}
		\includegraphics[height=\imh,width=0.45\linewidth]{images/rhoT5_run5h.png}
		\caption{$\rho$ for $\Delta t=0.025$. $N_x=256, N_{v_e}=N_{v_i}=1023$ (left): $N_x=4096  , N_{v_e}=8193,\ N_{v_i}=16385$ (right)}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}

	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=0.45\linewidth]{images/feT5_run5af.png}
		\includegraphics[height=\imh,width=0.45\linewidth]{images/feT5_run5h.png}
		\caption{$f_e$ for $\Delta t=0.025$. $N_x=256, N_{v_e}=N_{v_i}=1023$ (left): $N_x=4096  , N_{v_e}=8193,\ N_{v_i}=16385$ (right)}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=0.45\linewidth]{images/rhoT5_run5n.png}
		\includegraphics[height=\imh,width=0.45\linewidth]{images/rhoT5_run5z.png}
		\caption{$\rho$ for $\Delta t=0.0025$. $N_x=256, N_{v_e}=N_{v_i}=1023$ (left): $N_x=512  , N_{v_e}=N_{v_i} = 8193$ (right)}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}


	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=0.45\linewidth]{images/feT5_run5n.png}
		\includegraphics[height=\imh,width=0.45\linewidth]{images/feT5_run5z.png}
		\caption{$\rho$ for $\Delta t=0.0025$. $N_x=256, N_{v_e}=N_{v_i}=1023$ (left): $N_x=512  , N_{v_e}=N_{v_i} = 8193$ (right)}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}

%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh,width=0.2\linewidth]{images/rhoT5_run5n.png}
%		\includegraphics[height=\imh,width=0.2\linewidth]{images/rhoT5_run5z.png}
%		\includegraphics[height=\imh,width=0.2\linewidth]{images/feT5_run5n.png}
%		\includegraphics[height=\imh,width=0.2\linewidth]{images/feT5_run5z.png}
%		\caption{$T=5$}
%		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
%		%\label{subfig:compT200_E_rho}
%	\end{subfigure}


	\caption{Density $\rho$ and electron distribution function$f_e$ for time $T=5$; with $\Delta t=0.025$ and $\Delta t = 0.0025$
	 The semi-Lagrangian code is used; coarse mesh on the left and fine mesh on the right.
	%Run2; electron distribution function is also given, by changing $\Delta t$ to $0.000025$ (right)
	}
	\label{fig:comp_temps2}
\end{figure}  


So we have diminished the time step to $\Delta t = 0.00025$, and the comparison with the same simulations with  $\Delta t = 0.000025$ on Figure \ref{fig:comp_temps} 
is now much similar, which indicates that the 
time step is now fine enough. Note that for semi-Lagrangian schemes, taking the smallest possible time step does not necessarily lead to a better result (due to accumulation of errors, as the number of interpolations 
increases).


\begin{figure}
	\centering
	\newcommand{\rootSL}{../code_SL/}
%	\newcommand{\rootFD}{../../DynamicElectricSheath.jl/data/two_species/}
	\newcommand{\rootFD}{../temp_res_DF/}
	\newcommand{\dirSL}{run_comp_long_time_2sp_Nx1000_Nvi2001_Nve2001_Nt100000}
	\newcommand{\dirFD}{run_comp_long_time_2sp_Nx200_Nv400_Nt2500000}
	
	\renewcommand{\imh}{0.24\textheight}
	\renewcommand{\imw}{0.45\linewidth}
	
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=0.3\linewidth]{images/rhoT1.png}
		\includegraphics[height=\imh,width=0.3\linewidth]{images/feT1.png}
		\includegraphics[height=\imh,width=0.3\linewidth]{images/feT1_run_job2.png}
		\caption{$T=1$}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}

	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=0.3\linewidth]{images/rhoT2.png}
		\includegraphics[height=\imh,width=0.3\linewidth]{images/feT2.png}
		\includegraphics[height=\imh,width=0.3\linewidth]{images/feT2_run_job2.png}
		\caption{$T=2$}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}

	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=0.3\linewidth]{images/rhoT5.png}
		\includegraphics[height=\imh,width=0.3\linewidth]{images/feT5.png}
		\includegraphics[height=\imh,width=0.3\linewidth]{images/feT5_run_job2.png}
		\caption{$T=5$}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}

	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=0.3\linewidth]{images/rhoT10.png}
		\includegraphics[height=\imh,width=0.3\linewidth]{images/feT10.png}
		\includegraphics[height=\imh,width=0.3\linewidth]{images/feT10_run_job2.png}
		\caption{$T=10$}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}


	\caption{Density $\rho$ (left) and electron distribution function (middle and right) for time $T\in \{1,2,5,10\}$; 
	 The semi-Lagrangian code is used with parameters of Run2 (left, middle) and of Run3 (right).
	%Run2; electron distribution function is also given, by changing $\Delta t$ to $0.000025$ (right)
	}
	\label{fig:comp_temps}
\end{figure}  


We choose to use a very fine discretization in velocity for the electrons by taking $N_{v_e}=8193$ (some results, not shown, with $N_{v_e}=16385$ have lead to indistinguishable results).
We then make vary $N_x$ and $N_{v_i}$; we remark that $N_x$ can be quite lower and $N_{v_i}$ a little lower also, as we have similar results taking $(N_x,N_{v_i})=(256,2049)$ and 
$(N_x,N_{v_i})=(1024,4097)$, as we can see on Figure \ref{fig:comp_phasespace} (the first one is more diffusive which is coherent). 


\begin{figure}
	\centering
	\newcommand{\rootSL}{../code_SL/}
%	\newcommand{\rootFD}{../../DynamicElectricSheath.jl/data/two_species/}
	\newcommand{\rootFD}{../temp_res_DF/}
	\newcommand{\dirSL}{run_comp_long_time_2sp_Nx1000_Nvi2001_Nve2001_Nt100000}
	\newcommand{\dirFD}{run_comp_long_time_2sp_Nx200_Nv400_Nt2500000}
	
	\renewcommand{\imh}{0.24\textheight}
	\renewcommand{\imw}{0.45\linewidth}
	
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/E_run5ab.png}
		\includegraphics[height=\imh,width=\imw]{images/E_run5ac.png}
		\caption{Electric field}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/rho_run5ab.png}
		\includegraphics[height=\imh,width=\imw]{images/rho_run5ac.png}
		\caption{Density $\rho$}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}
	
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/fi_run5ab.png}
		\includegraphics[height=\imh,width=\imw]{images/fi_run5ac.png}
		\caption{Ion distribution function} 
		%\label{subfig:compT200_ion}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/fe_run5ab.png}
		\includegraphics[height=\imh,width=\imw]{images/fe_run5ac.png}
		\caption{Electron distribution function}
		%\label{subfig:compT200_electron}
	\end{subfigure}
	\caption{Comparison of semi-Lagrangian code: parameters of Run1 (left column) and parameters of Run2 (right column).}
	%for different discretizations. Run1:  $N_x=256,\ N_{v_i}=2049$ (left); Run2: $N_x=1024,\ N_{v_i}=4097$ (right) at $T=20$.
	%Other numerical parameters are $N_{v_e}=8193$ and $\Delta t = 0.00025$. We have used $[-60,60]$ for $v_e$ and  $[-50,50]$ for $v_i$.
	%The ion density is zoomed for $v_i\in [-5,5]$
	%}
	\label{fig:comp_phasespace}
\end{figure}  



%We would like to have a solution that is 

%We want here to compare the semi-Lagrangian code with different discretizations.
%We have here no exact solution at hand to validate the code; so we validate it by comparing the numerical parameters. We restrict here to final time $T=20$ and look for "converged" numerical parameters.
%It is beneficial that the code is parallel (remap strategy of the selalib project\footnote{\url{https://selalib.github.io/selalib.html}}); in practice we do the simulations on a labtop or in the mesocentre of Marseille
%($16$ cores for interactive mode and $32$ cores for submitted jobs, which can be prone to delays, depending on the queue).
%
%We choose to use a high number for the electron density, by taking $N_v=8193$, 
%and we study the change for $N_x$ and $N_{v_i}$, taking first $N_x=256$ and $N_{v_i}=2049$, and then taking $N_x=1024$ and  $N_{v_i}=4097$.
%Numerical results are shown on Figure \ref{fig:comp_phasespace}. We clearly see that the results are quite similar, with a more diffusive solution for the coarser mesh, which is encouraging.
%
%On Figure \ref{fig:comp_temps}, we study the validity of the time discretization, changing the value of $\Delta t$, which goes from
%$\Delta t=0.00125$ to $\Delta t=0.000125$. We again see that results are very similar, which is a good point.
%
%
%The ion density and the electric field seem not to change much; but the electron density is varying a lot and becomes more and more complex with respect to time,
%and filaments appear. Note that we have to take quite small time steps, as we have chosen $\mu=1/100$, which makes the study more difficult, but it is nearer to more physically relevant parameters. 
%We have chosen also a high number for $N_{v_e}$; this permits to better keep the symmetry, without imposing it a priori (which is in fact possible, by a symmetrization of $\rho$).

We remark also that the spatial interpolation does not lead to unstable results, which can occur sometimes when extrapolation is used (see \cite{badsiNumericalStabilityPlasma2018}). 
To our understanding, this is due to the fact that interpolation of nontrivial functions happens only on the outflow boundary, and any oscillation is evacuated immediately without propagation in the computational domain. 
We have used an odd number of points in order to prevent from having $0$ as a mesh point, which would lead to increase of the value at constant rate, in the ionization step.

The study of the numerical equilibrium and the study of the behaviour of the ion density around $(0,0)$, which is quite complex at equilibrium, are not tackled here and are out of the scope of this work.


In Figure \ref{fig:comp_E0_intE0}, we compare the solutions given by the semi-Lagrangian code when three different boundary conditions for the Poisson solver are used. At the numerical level, we see that the first one $E(t,0) = 0$ yields a loss of symmetry in the solution while the two others preserve it. At a physical level, we observe that the electric field is monotone increasing  and consequently low energetic electrons (see Figure (d)) are essentially confined while ions are prone  to be accelerated and lost at the wall (see Figure (c)).

%\textcolor{red}{Commentaire pour figure \ref{fig:comp_E0_intE0}}


%\begin{figure}
%	\centering
%	\newcommand{\rootSL}{../code_SL/}
%%	\newcommand{\rootFD}{../../DynamicElectricSheath.jl/data/two_species/}
%	\newcommand{\rootFD}{../temp_res_DF/}
%	\newcommand{\dirSL}{run_comp_short_time_2sp_Nx1000_Nvi2001_Nve2001_Nt1563}
%	\newcommand{\dirFD}{run_comp_short_time_2sp_Nx1000_Nv2000_Nt1563}
%	\renewcommand{\imh}{0.33\linewidth}
%	
%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh]{\rootFD\dirFD/comp_E_\dirSL.png}
%		\includegraphics[height=\imh]{\rootFD\dirFD/comp_rho_\dirSL.png}
%		\caption{Electric field (left) and density $\rho$ (right)}
%		\label{subfig:compT0025_E_rho}
%	\end{subfigure}
%	
%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh]{\rootFD\dirFD/fi}
%		\includegraphics[height=\imh]{\rootSL\dirSL/python_diags/fi}
%		\caption{Ion density}
%		\label{subfig:compT0025_ion}
%	\end{subfigure}
%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh]{\rootFD\dirFD/fe}
%		\includegraphics[height=\imh]{\rootSL\dirSL/python_diags/fe}
%		\caption{Electron density}
%		\label{subfig:compT0025_electron}
%	\end{subfigure}
%	\caption{Comparison between finite differences (left) and semi-Lagrangian (right) at $T=0.025$.}
%	\label{fig:compT0025}
%\end{figure}  
%
%\Cref{fig:compT0025} illustrates the very short-time behaviour of both codes. At time $t=0$, the initial conditions are chosen so that $E = \rho = 0$, corresponding to a neutral plasma. The initial velocity field is then given by $(v, 0)$, and we observe the shear of the initial conditions. The electric field conserve the same variations through both codes, with a difference in scale.

%\begin{figure}
%	\centering
%	\newcommand{\rootSL}{../code_SL/}
%%	\newcommand{\rootFD}{../../DynamicElectricSheath.jl/data/two_species/}
%	\newcommand{\rootFD}{../temp_res_DF/}
%	\newcommand{\dirSL}{run_comp_short_time_2sp_Nx1000_Nvi2001_Nve2001_Nt6250}
%	\newcommand{\dirFD}{run_comp_short_time_2sp_Nx1000_Nv2000_Nt6250}
%	
%	\renewcommand{\imh}{0.33\linewidth}
%	
%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh]{\rootFD\dirFD/comp_E_\dirSL.png}
%		\includegraphics[height=\imh]{\rootFD\dirFD/comp_rho_\dirSL.png}
%		\caption{Electric field (left) and density $\rho$ (right)}
%		\label{subfig:compT01_E_rho}
%	\end{subfigure}
%	
%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh]{\rootFD\dirFD/fi}
%		\includegraphics[height=\imh]{\rootSL\dirSL/python_diags/fi}
%		\caption{Ion density}
%		\label{subfig:compT01_ion}
%	\end{subfigure}
%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh]{\rootFD\dirFD/fe}
%		\includegraphics[height=\imh]{\rootSL\dirSL/python_diags/fe}
%		\caption{Electron density}
%		\label{subfig:compT01_electron}
%	\end{subfigure}
%	\caption{Comparison between finite differences (left) and semi-Lagrangian (right) at $T=0.1$.}
%	\label{fig:compT01}
%\end{figure}  


%\begin{figure}
%	\centering
%	\newcommand{\rootSL}{../code_SL/}
%%	\newcommand{\rootFD}{../../DynamicElectricSheath.jl/data/two_species/}
%	\newcommand{\rootFD}{../temp_res_DF/}
%	\newcommand{\dirSL}{run_comp_long_time_2sp_Nx1000_Nvi2001_Nve2001_Nt100000}
%	\newcommand{\dirFD}{run_comp_long_time_2sp_Nx200_Nv400_Nt2500000}
%	
%	\renewcommand{\imh}{0.33\linewidth}
%	
%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh]{\rootFD\dirFD/comp_E_\dirSL.png}
%		\includegraphics[height=\imh]{\rootFD\dirFD/comp_rho_\dirSL.png}
%		\caption{Electric field (left) and density $\rho$ (right)}
%		\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
%		\label{subfig:compT200_E_rho}
%	\end{subfigure}
%	
%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh]{\rootFD\dirFD/fi}
%		\includegraphics[height=\imh]{\rootSL\dirSL/python_diags/fi}
%		\caption{Ion density} 
%		\label{subfig:compT200_ion}
%	\end{subfigure}
%	\begin{subfigure}{\textwidth}
%		\centering
%		\includegraphics[height=\imh]{\rootFD\dirFD/fe}
%		\includegraphics[height=\imh]{\rootSL\dirSL/python_diags/fe}
%		\caption{Electron density}
%		\label{subfig:compT200_electron}
%	\end{subfigure}
%	\caption{Comparison between finite differences (left) and semi-Lagrangian (right) at $T=200$.}
%	\label{fig:compT200}
%\end{figure}  

%The behavior of the ion densition 




\begin{figure}
	\centering
	\newcommand{\rootSL}{../code_SL/}
%	\newcommand{\rootFD}{../../DynamicElectricSheath.jl/data/two_species/}
	\newcommand{\rootFD}{../temp_res_DF/}
	\newcommand{\dirSL}{run_comp_long_time_2sp_Nx1000_Nvi2001_Nve2001_Nt100000}
	\newcommand{\dirFD}{run_comp_long_time_2sp_Nx200_Nv400_Nt2500000}
	
	\renewcommand{\imh}{0.24\textheight}
	\renewcommand{\imw}{0.3\linewidth}
	
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/ET20_run5af.png}
		\includegraphics[height=\imh,width=\imw]{images/ET20_run5af_2.png}
		\includegraphics[height=\imh,width=\imw]{images/ET20_run5af_3.png}
		\caption{Electric field}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/rhoT20_run5af.png}
		\includegraphics[height=\imh,width=\imw]{images/rhoT20_run5af_2.png}
		\includegraphics[height=\imh,width=\imw]{images/rhoT20_run5af_3.png}
		\caption{Density $\rho$}
		%\mysubcaption{The maximum of $\rho$ for the (DF) code is equal to 39.983965094090.}
		%\label{subfig:compT200_E_rho}
	\end{subfigure}
	
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/fiT20_run5af.png}
		\includegraphics[height=\imh,width=\imw]{images/fiT20_run5af_2.png}
		\includegraphics[height=\imh,width=\imw]{images/fiT20_run5af_3.png}
		\caption{Ion distribution function} 
		%\label{subfig:compT200_ion}
	\end{subfigure}
	\begin{subfigure}{\textwidth}
		\centering
		\includegraphics[height=\imh,width=\imw]{images/feT20_run5af.png}
		\includegraphics[height=\imh,width=\imw]{images/feT20_run5af_2.png}
		\includegraphics[height=\imh,width=\imw]{images/feT20_run5af_3.png}
		\caption{Electron distribution function}
		%\label{subfig:compT200_electron}
	\end{subfigure}
	\caption{Comparison of the numerical approximation of the Poisson equation in the semi-Lagrangian code: $E(t,0)=0$ (left column), $E(t,1)=-E(t,-1)$ (middle column) and $\int_{-1}^1E(t,x)dx=0$ (right column). 
	 $\Delta t=0.025$. $N_x=256, N_{v_e}=N_{v_i}=1023$.}
	%for different discretizations. Run1:  $N_x=256,\ N_{v_i}=2049$ (left); Run2: $N_x=1024,\ N_{v_i}=4097$ (right) at $T=20$.
	%Other numerical parameters are $N_{v_e}=8193$ and $\Delta t = 0.00025$. We have used $[-60,60]$ for $v_e$ and  $[-50,50]$ for $v_i$.
	%The ion density is zoomed for $v_i\in [-5,5]$
	%}
	\label{fig:comp_E0_intE0}
\end{figure}  


\section{Conclusion}

This work discussed the development of a semi-Lagrangian scheme for the numerical simulation of a two-species plasma model involving sheath. Specific treatment of the boundary conditions have been proposed. For comparison, a 1st-order finite difference scheme has been implemented. Both schemes are first validated on a one-species test case for which an analytic solution is known. Then we obtained simulations for the full two-species case.

We obtain first promising results that encourage us to go further in the study of this semi-Lagrangian scheme coupled with boundary conditions. Long-time behaviour is a difficult question for which it would be very interesting to have a reference solution, given by the stationary problem. This is however out of the scope of this work.


\bibliographystyle{alpha}
\bibliography{CEMRACS.bib}

\end{document}